jmg's super code is in this awsome file.
